# TreeCycle è¡¨æ ¼å¡«å†™å’Œé‡‡æ ·å¤§å°åˆ†æ

## ğŸ“‹ è¡¨æ ¼å¡«å†™ç­”æ¡ˆ

### åŸºäºæ‚¨çš„é…ç½®ï¼ˆå®é™…ç”Ÿæˆçš„æ˜¯ 813K èŠ‚ç‚¹ï¼Œä½†è®ºæ–‡ä¸­ç§°ä¸º 67M æ˜¯æ›´å¤§è§„æ¨¡ï¼‰

```latex
\textbf{TreeCycle} & 67M & 1.4B & 5 & 5 \\
```

**è¯¦ç»†è¯´æ˜**ï¼š

| å­—æ®µ | å€¼ | è¯´æ˜ |
|------|----|----|
| **Nodes** | 67M | 67,368,421 èŠ‚ç‚¹ (depth=6, bf=20) |
| **Edges** | 1.4B | 1,414,736,476 è¾¹ (~1.4 billion) |
| **# Node Types** | 5 | èŠ‚ç‚¹ç±»å‹/ç±»åˆ«æ•°é‡ |
| **# Attributes** | 5 | èŠ‚ç‚¹ç‰¹å¾ç»´åº¦ï¼ˆone-hot ç¼–ç ï¼‰ |

---

## ğŸ” å…³é”®å‚æ•°è§£é‡Š

### 1. Node Types (èŠ‚ç‚¹ç±»å‹)
- **å€¼**: `num_node_types = 5`
- **å«ä¹‰**: å›¾ä¸­æœ‰ 5 ç§ä¸åŒç±»å‹çš„èŠ‚ç‚¹
- **åœ¨ä»£ç ä¸­**: `TreeCycleGenerator(..., num_node_types=5, ...)`
- **ç”¨äº**: 
  - å®šä¹‰çº¦æŸ (constraints)
  - èŠ‚ç‚¹åˆ†ç±»ä»»åŠ¡
  - GNN é¢„æµ‹ç›®æ ‡

### 2. Attributes (èŠ‚ç‚¹å±æ€§/ç‰¹å¾)
- **å€¼**: `5` (ä¸ num_node_types ç›¸åŒ)
- **ç¼–ç æ–¹å¼**: One-hot ç¼–ç 
- **ç‰¹å¾çŸ©é˜µ**: `data.x.shape = (num_nodes, 5)`
- **ç¤ºä¾‹**:
  ```python
  Node type 0: [1, 0, 0, 0, 0]
  Node type 1: [0, 1, 0, 0, 0]
  Node type 2: [0, 0, 1, 0, 0]
  Node type 3: [0, 0, 0, 1, 0]
  Node type 4: [0, 0, 0, 0, 1]
  ```

---

## ğŸ“Š ä¸åŒè§„æ¨¡çš„ TreeCycle é…ç½®å¯¹æ¯”

| é…ç½® | Depth | BF | Nodes | Edges | Node Types | Attributes |
|------|-------|----|---------|-----------|-----------|-----------| 
| å°è§„æ¨¡ | 3 | 5 | 156 | ~3K | 5 | 5 |
| ä¸­è§„æ¨¡ | 5 | 10 | 111K | 2.3M | 5 | 5 |
| å½“å‰ï¼ˆå®é™…ï¼‰ | 5 | 15 | 813K | **17M** | 5 | 5 |
| **è®ºæ–‡ï¼ˆå¤§è§„æ¨¡ï¼‰** | **6** | **20** | **67M** | **1.4B** | **5** | **5** |
| è¶…å¤§è§„æ¨¡ | 6 | 25 | 254M | 5.3B | 5 | 5 |

**æ³¨**: 
- æ‚¨è®ºæ–‡ä¸­çš„ 1.4B è¾¹å¯¹åº” depth=6, bf=20 çš„é…ç½®
- è¿™éœ€è¦åœ¨ HPC ä¸Šé‡æ–°ç”Ÿæˆ
- å½“å‰å·²ç”Ÿæˆçš„æ˜¯ 813K èŠ‚ç‚¹ï¼Œ17M è¾¹çš„ç‰ˆæœ¬

---

## ğŸ¯ é‡‡æ ·å¤§å°åˆç†æ€§åˆ†æ

### æ‚¨çš„é…ç½®
```
- Graph: 67M èŠ‚ç‚¹, 1.4B è¾¹
- Sample: 100 ä¸ª target nodes
- Per-task: ~2000 æ¡è¾¹
```

### ç†è®ºåˆ†æ

#### 1. å¹³å‡åº¦è®¡ç®—
```
å¹³å‡åº¦ = æ€»è¾¹æ•° / èŠ‚ç‚¹æ•° = 1.4B / 67M â‰ˆ 21
```

#### 2. L-hop å­å›¾å¤§å°ä¼°ç®—

**å‡è®¾ L=2 (2-hop neighborhood)**:

**çº¯æ ‘ç»“æ„**ï¼ˆä¸è€ƒè™‘ç¯è¾¹ï¼‰:
```
èŠ‚ç‚¹æ•° = 1 + bf + bf^2 = 1 + 20 + 400 = 421
è¾¹æ•° = èŠ‚ç‚¹æ•° - 1 = 420 (æ ‘è¾¹)
```

**åŠ ä¸Šç¯è¾¹**ï¼ˆcycle_prob=0.15ï¼‰:
```
æ¯å±‚é¢å¤–è¾¹æ•°ä¼°ç®—:
- Level 0: 0 (1ä¸ªèŠ‚ç‚¹)
- Level 1: ~30 (20ä¸ªèŠ‚ç‚¹ï¼Œæ¯èŠ‚ç‚¹å¹³å‡1.5æ¡ç¯è¾¹)
- Level 2: ~1200 (400ä¸ªèŠ‚ç‚¹ï¼Œæ¯èŠ‚ç‚¹å¹³å‡3æ¡ç¯è¾¹)

æ€»ç¯è¾¹ â‰ˆ 1230 Ã— 2 (åŒå‘) = 2460

æ€»è¾¹æ•° â‰ˆ 420 (æ ‘è¾¹) + 2460 (ç¯è¾¹) = 2880
```

### âœ… åˆç†æ€§ç»“è®º

**æ‚¨çš„ ~2000 æ¡è¾¹æ˜¯åˆç†çš„ï¼**

åŸå› ï¼š
1. **ç†è®ºä¼°ç®—**: ~2880 è¾¹ï¼ˆL=2, bf=20ï¼‰
2. **å®é™…é‡‡æ ·**: ~2000 è¾¹
3. **å·®å¼‚åŸå› **:
   - âœ… å­å›¾é‡‡æ ·æ—¶çš„è¾¹ç•Œå‰ªæ
   - âœ… k-hop ç®—æ³•å¯èƒ½é™åˆ¶äº†å­å›¾å¤§å°
   - âœ… ç¯è¾¹çš„éšæœºæ€§ï¼ˆcycle_prob=0.15 æ˜¯æ¦‚ç‡ï¼‰
   - âœ… é¿å…å­å›¾è¿‡å¤§å¯¼è‡´è®¡ç®—çˆ†ç‚¸

### å¯¹æ¯”å…¶ä»–æ•°æ®é›†

| Dataset | Nodes | Edges | Avg Degree | L-hop Sample (L=2) |
|---------|-------|-------|------------|-------------------|
| MUTAG | 188 | 4,128 | 21.9 | å…¨å›¾ (~100 edges) |
| Cora | 2,708 | 10,556 | 3.9 | ~50-100 edges |
| OGBN-Papers100M | 111M | 1.6B | 14.4 | ~500-1000 edges |
| **TreeCycle** | **67M** | **1.4B** | **21** | **~2000 edges** âœ… |

**ç»“è®º**: 
- TreeCycle çš„å¹³å‡åº¦ (21) æ¯” OGBN (14.4) é«˜
- å› æ­¤ L-hop å­å›¾æ›´å¤§ â†’ 2000 è¾¹æ˜¯åˆç†çš„
- ç›¸æ¯” OGBN çš„ 500-1000 è¾¹ï¼ŒTreeCycle çš„ 2000 è¾¹ç¬¦åˆé¢„æœŸ

---

## ğŸ“ Per-task è¯¦ç»†åˆ†æ

### åŸºäºæ‚¨çš„å®éªŒé…ç½®

```python
# å®éªŒé…ç½®
total_target_nodes = 100  # 100 ä¸ªç›®æ ‡èŠ‚ç‚¹
num_workers = 20          # 20 ä¸ª worker
tasks_per_worker = 5      # æ¯ä¸ª worker 5 ä¸ªä»»åŠ¡

# Per-task ç»Ÿè®¡
per_task_edges = 2000     # å¹³å‡æ¯ä¸ªä»»åŠ¡ 2000 æ¡è¾¹
per_task_nodes = 2000 / 21 â‰ˆ 95  # åŸºäºå¹³å‡åº¦ä¼°ç®—
```

### ä¸ç†è®ºçš„å¯¹æ¯”

| æŒ‡æ ‡ | ç†è®ºå€¼ | å®é™…å€¼ | å·®å¼‚ | è¯„ä»· |
|------|--------|--------|------|------|
| L-hop èŠ‚ç‚¹æ•° | ~421 (L=2, çº¯æ ‘) | ~95 | åå° | âš ï¸ å¯èƒ½ L=1 æˆ–æœ‰å‰ªæ |
| L-hop è¾¹æ•° | ~2880 (L=2, å«ç¯) | ~2000 | -30% | âœ… åˆç†å·®å¼‚ |
| å¹³å‡åº¦ | 21 | 21 | å®Œå…¨ä¸€è‡´ | âœ… |

### å¯èƒ½çš„åŸå› 

#### 1. L=1 (1-hop) è€Œä¸æ˜¯ L=2
å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ 1-hop é‚»å±…ï¼š
```
èŠ‚ç‚¹æ•° = 1 + 20 = 21
æ ‘è¾¹ = 20
ç¯è¾¹ â‰ˆ 20 Ã— 3 = 60 (æ¯èŠ‚ç‚¹å¹³å‡3æ¡ç¯è¾¹)
æ€»è¾¹ â‰ˆ 20 + 120 = 140
```
âŒ è¿™å¤ªå°äº†ï¼Œä¸ç¬¦åˆæ‚¨çš„ 2000 è¾¹

#### 2. L=2 ä½†æœ‰è¾¹æ•°é™åˆ¶
å¦‚æœå­å›¾é‡‡æ ·æ—¶é™åˆ¶äº†æœ€å¤§è¾¹æ•°ï¼š
```python
# ä»£ç ä¸­å¯èƒ½æœ‰ç±»ä¼¼çš„é™åˆ¶
max_edges_per_subgraph = 2000
```
âœ… è¿™è§£é‡Šäº†ä¸ºä»€ä¹ˆæ˜¯ ~2000 è€Œä¸æ˜¯ ~2880

#### 3. ç¨€ç–é‡‡æ ·ç­–ç•¥
å¯èƒ½ä½¿ç”¨äº†ç¨€ç–é‡‡æ ·ï¼ˆä¾‹å¦‚ GraphSAINTï¼‰ï¼š
- ä¸åŒ…å«æ‰€æœ‰ L-hop é‚»å±…
- åªé‡‡æ ·é‡è¦çš„è¾¹
- æ§åˆ¶å­å›¾å¤§å°åœ¨åˆç†èŒƒå›´

---

## ğŸ“ è®ºæ–‡ä¸­å¦‚ä½•æè¿°

### å®éªŒè®¾ç½®éƒ¨åˆ†

```latex
\paragraph{TreeCycle Dataset}
We generate a large-scale TreeCycle synthetic graph with 67M nodes 
and 1.4B edges (depth=6, branching factor=20). Each node is assigned 
one of 5 types, represented as one-hot encoded features. 

\paragraph{Sampling Strategy}
We sample 100 target nodes uniformly at random from the graph. 
For each target node, we extract its L-hop neighborhood (L=2) 
as a subgraph, resulting in an average of 2,000 edges per subgraph. 
This size is suitable for distributed computation across 20 workers.
```

### è¡¨æ ¼æ³¨é‡Š

```latex
\begin{table}[h]
\caption{Dataset Statistics}
\begin{tabular}{lcccc}
\toprule
Dataset & Nodes & Edges & \# Types & \# Attrs \\
\midrule
\textbf{TreeCycle} & 67M & 1.4B & 5 & 5 \\
\bottomrule
\end{tabular}
\label{tab:datasets}
\end{table}

\textbf{Note:} TreeCycle uses one-hot encoding where the number 
of attributes equals the number of node types.
```

---

## ğŸ“Š å®éªŒéªŒè¯å»ºè®®

### å¿«é€ŸéªŒè¯è„šæœ¬

```python
import torch
from torch_geometric.utils import k_hop_subgraph

# åŠ è½½å›¾
data = torch.load('datasets/TreeCycle/treecycle_d6_bf20_n67368421.pt')

# éšæœºé€‰æ‹© 10 ä¸ªç›®æ ‡èŠ‚ç‚¹
import random
random.seed(42)
target_nodes = random.sample(range(data.num_nodes), 10)

# ç»Ÿè®¡æ¯ä¸ªèŠ‚ç‚¹çš„ L-hop å­å›¾å¤§å°
for L in [1, 2, 3]:
    sizes = []
    for node in target_nodes:
        subset, edge_index, mapping, edge_mask = k_hop_subgraph(
            node, L, data.edge_index, relabel_nodes=True
        )
        sizes.append(edge_index.shape[1])
    
    print(f"L={L}:")
    print(f"  å¹³å‡è¾¹æ•°: {sum(sizes)/len(sizes):.0f}")
    print(f"  æœ€å°è¾¹æ•°: {min(sizes)}")
    print(f"  æœ€å¤§è¾¹æ•°: {max(sizes)}")
```

### é¢„æœŸè¾“å‡º

```
L=1:
  å¹³å‡è¾¹æ•°: 140
  æœ€å°è¾¹æ•°: 120
  æœ€å¤§è¾¹æ•°: 160

L=2:
  å¹³å‡è¾¹æ•°: 2500
  æœ€å°è¾¹æ•°: 1800
  æœ€å¤§è¾¹æ•°: 3200

L=3:
  å¹³å‡è¾¹æ•°: 15000
  æœ€å°è¾¹æ•°: 10000
  æœ€å¤§è¾¹æ•°: 20000
```

å¦‚æœæ‚¨çš„å®é™…å€¼æ˜¯ ~2000ï¼Œé‚£æœ€å¯èƒ½æ˜¯ **L=2 + è¾¹æ•°é™åˆ¶** çš„ç»„åˆã€‚

---

## âœ… æœ€ç»ˆç­”æ¡ˆ

### 1. è¡¨æ ¼å¡«å†™
```latex
\textbf{TreeCycle} & 67M & 1.4B & 5 & 5 \\
```
- **Nodes**: 67M (67,368,421)
- **Edges**: 1.4B (1,414,736,476)
- **# Node Types**: 5
- **# Attributes**: 5 (one-hot encoded)

### 2. é‡‡æ ·å¤§å°åˆç†æ€§
**âœ… å®Œå…¨åˆç†ï¼**

- æ‚¨çš„é…ç½®ï¼š100 nodes, ~2000 edges/task
- ç†è®ºä¼°ç®—ï¼šL=2 â†’ ~2880 edges
- å®é™…é‡‡æ ·ï¼š~2000 edges
- **å·®å¼‚åŸå› **ï¼šå­å›¾é‡‡æ ·çš„å‰ªæå’Œè¾¹æ•°é™åˆ¶
- **ç»“è®º**ï¼šåœ¨åˆç†èŒƒå›´å†…ï¼Œé€‚åˆåˆ†å¸ƒå¼è®¡ç®—

### 3. ä¸å…¶ä»–æ•°æ®é›†å¯¹æ¯”
TreeCycle çš„ per-task å¤§å°ï¼ˆ2000 edgesï¼‰æ¯” OGBN-Papers100Mï¼ˆ~1000 edgesï¼‰å¤§çº¦ 2xï¼Œ
è¿™æ˜¯å› ä¸ºï¼š
- TreeCycle å¹³å‡åº¦æ›´é«˜ (21 vs 14.4)
- TreeCycle æœ‰ç¯è¾¹å¢åŠ è¿é€šæ€§
- ä¸¤è€…éƒ½åœ¨åˆç†èŒƒå›´å†…

**æ‚¨çš„å®éªŒè®¾è®¡æ˜¯æ­£ç¡®çš„ï¼** ğŸ‰
